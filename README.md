# 🔥 火災偵測系統

基於深度學習的智能火災偵測與應急處置系統

## 主要功能

- **智能火災偵測**：使用 CNN 深度學習模型進行火災識別
- **智能分析報告**：整合本地大語言模型提供專業建議
- **角色化建議**：根據使用者身份（一般民眾/消防隊員/管理單位）提供個性化建議
- **視覺化界面**：直觀的 Web 界面，支援拖拽上傳
- **專業 SOP**：內建火災應急處置標準作業程序

## 系統架構

### 核心技術
- **深度學習引擎**：自訓練的 CNN 模型，專門針對火災場景優化
- **本地語言引擎**：支援 Ollama/Gemma 等本地大語言模型
- **Flask 後端**：RESTful API 設計，支援圖片上傳與分析
- **響應式前端**：現代化 Web 界面，支援多種設備

### 檔案結構
```
fire_report_project/
├── app.py                 # Flask 主應用程式
├── run.py                 # 系統啟動腳本
├── requirements.txt       # 依賴套件清單
├── templates/
│   └── index.html        # Web 前端界面
├── static/
│   ├── css/              # 樣式檔案
│   ├── js/               # JavaScript 檔案
│   └── uploads/          # 上傳圖片目錄
├── models/
│   └── fire_detection/   # 火災偵測模型
├── knowledge_base/
│   └── sop.json         # SOP 知識庫
└── .env                  # 環境變數設定
```

## 快速開始

### 1. 環境準備
```bash
# 建立虛擬環境
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# 或 .venv\Scripts\activate  # Windows

# 安裝依賴
pip install -r requirements.txt
```

### 2. 模型設定
確保 `models/fire_detection/` 目錄下有訓練好的模型檔案

### 3. 啟動系統
```bash
python run.py
```

系統將在 http://127.0.0.1:5002 啟動

## 使用說明

### 基本使用流程
1. **選擇身份**：一般民眾/消防隊員/管理單位
2. **上傳圖片**：支援 JPG、PNG 格式，最大 16MB
3. **獲得分析**：系統自動進行火災檢測和智能分析
4. **查看建議**：根據身份獲得專業的應急處置建議

### API 端點
- **`POST /api/detect`**：火災偵測主 API
- **`GET /api/fire-safety-advice`**：獲取火災安全建議  
- **`POST /api/analyze-fire-intensity`**：火勢強度分析

## 設定說明

### 環境變數 (.env)
```bash
# 本地語言引擎設定
OLLAMA_HOST=http://127.0.0.1:11434
OLLAMA_MODEL=gemma:7b

# 系統設定
FLASK_ENV=development
FLASK_DEBUG=true
```

### 角色建議系統
系統根據使用者身份提供不同層級的建議：

- **一般民眾**：基礎逃生指導、緊急聯絡方式
- **消防隊員**：戰術評估、器材配置、安全協議
- **管理單位**：資源調度、應急管理、公眾溝通

## 技術特色

### 1. 深度學習檢測
- 使用自訓練的 CNN 模型
- 支援多種火災場景識別
- 高準確率的二元分類（火災/非火災）

### 2. 本地智能分析
- 整合 Ollama 本地大語言模型
- 無需外部 API 依賴
- 保護資料隱私安全

### 3. 專業知識庫
- 內建標準作業程序（SOP）
- 分角色專業建議系統
- 可擴展的知識庫架構

### 4. 現代化界面
- 響應式設計，支援多設備
- 拖拽上傳，操作便利
- 即時進度顯示
- 美觀的結果展示

## 系統需求

### 硬體需求
- **CPU**：多核心處理器推薦
- **RAM**：至少 8GB（模型載入需求）
- **儲存**：至少 5GB 可用空間

### 軟體需求
- **Python** 3.8+
- **PyTorch**
- **Flask**
- **Pillow**
- **其他依賴**：詳見 requirements.txt

## 故障排除

### 常見問題
1. **模型載入失敗**：確認模型檔案路徑正確
2. **端口被佔用**：檢查 5002 端口是否可用
3. **圖片上傳失敗**：確認檔案格式和大小限制
4. **語言引擎無回應**：確認 Ollama 服務運行狀態

### 日誌查看
系統日誌保存在 `logs/app.log`，包含詳細的運行資訊和錯誤記錄。

## 貢獻指南

歡迎提交 Issue 和 Pull Request 來改善系統功能。

## 授權條款

本專案採用開源授權，詳情請查看 LICENSE 檔案。

---

🔥 **重要提醒**：本系統僅供輔助參考，實際火災情況請優先確保人身安全並立即聯絡消防單位。
