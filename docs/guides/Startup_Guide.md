# 🔥 火災偵測系統啟動說明

## 📋 啟動方式

### 1. 標準啟動
```bash
python run.py
```
- ✅ **完全自動化**：自動檢測並終止佔用端口的進程
- 🚀 **無需確認**：直接清理並啟動，無需手動介入
- 💪 **智能處理**：自動識別進程並優雅終止
- 🔧 **穩定啟動**：禁用 Flask 自動重載，避免進程衝突

### 2. 備用啟動
```bash
python run_auto.py
```
- 🔄 **功能相同**：與 run.py 功能完全一致
- ⚡ **完全自動**：同樣無需任何手動介入
- 🛡️ **備用選擇**：提供多個啟動選項
- 🔧 **同步修復**：同樣解決了 Flask 重載問題

### 3. 指定端口啟動
```bash
PORT=5003 python run.py
PORT=5003 python run_auto.py
```
- 🔧 **自定義端口**：使用不同端口避免衝突
- 🌐 **多實例運行**：適合同時運行多個服務

## 🔧 功能特點

### ✅ 完全自動化
- **零手動介入**：無需任何用戶確認或輸入
- **智能檢測**：自動識別佔用端口的進程
- **自動清理**：直接終止佔用進程並啟動系統
- **重試機制**：最多嘗試 3 次清理，確保成功

### 💀 進程終止機制
- **優雅終止**：先嘗試 `SIGTERM` 信號
- **強制終止**：如果進程未響應，自動使用 `SIGKILL`
- **等待機制**：給進程足夠時間正常退出（3-5秒）
- **多重檢查**：5次驗證端口是否真正釋放

### 📊 詳細信息顯示
- **進程識別**：顯示佔用進程的 PID 和命令信息
- **操作反饋**：提供清晰的自動處理進度
- **狀態報告**：實時顯示處理結果和重試次數

### 🛠️ 技術改進
- **Flask 重載修復**：禁用自動重載避免進程衝突
- **延長等待時間**：增加進程終止後的等待時間
- **重試邏輯**：添加多次重試機制確保成功

## 🚀 使用建議

### 👨‍💻 日常開發
```bash
# 直接使用，完全自動化
python run.py
```

### 🔧 測試部署
```bash
# 備用腳本，功能相同
python run_auto.py
```

### 🌐 生產環境
```bash
# 指定端口，避免衝突
PORT=8080 python run.py
```

## 🔄 自動化流程

### 1. 端口檢測
- 🔍 自動檢查端口 5002 是否被佔用
- 📊 使用 `netstat` 識別佔用進程

### 2. 自動清理（重試機制）
- 💀 自動終止佔用進程（無需確認）
- ⏱️ 等待端口釋放（3-5秒）
- 🔄 最多重試 3 次確保成功
- ✅ 5次驗證端口釋放狀態

### 3. 系統啟動
- 🚀 自動啟動火災偵測系統
- 🛠️ 禁用 Flask 自動重載避免衝突
- 🌐 顯示訪問網址
- 📋 準備接受請求

## 🎯 系統狀態

### ✅ 正常流程
```
🔥 火災偵測系統啟動中...
✅ 系統載入成功
⚠️ 端口 5002 已被佔用！
⚠️ 端口 5002 被佔用，正在自動清理... (嘗試 1/3)
🔍 發現進程 PID: 12345
📋 進程信息: 12345 1234 python run.py
💀 自動終止進程 12345...
✅ 成功終止進程 12345
⏳ 等待端口釋放... (1/5)
🎉 端口 5002 已釋放
✅ 端口衝突已自動解決，繼續啟動...
🚀 系統啟動中...
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://127.0.0.1:5002
```

### 🌐 訪問地址
- **主要地址**：http://127.0.0.1:5002
- **備用地址**：http://localhost:5002

### 🛑 停止系統
- 按 `Ctrl+C` 正常停止
- 系統會自動清理資源

## 🚨 注意事項

### ⚠️ 自動終止說明
- **完全自動化**：腳本會自動終止佔用端口的進程
- **無需確認**：不會詢問用戶是否要終止進程
- **安全保障**：只終止佔用指定端口的進程
- **重試保障**：最多3次重試確保清理成功

### 🔍 故障排除

#### 如果自動清理失敗
```bash
# 手動檢查端口佔用
netstat -tulpn | grep :5002

# 手動終止所有相關進程
pkill -f "python.*run"

# 等待幾秒後重新啟動
python run.py
```

#### 如果需要使用其他端口
```bash
# 臨時使用其他端口
PORT=5003 python run.py
```

#### 如果遇到 Flask 重載問題
```bash
# 新版本已修復，如仍有問題可檢查：
ps aux | grep python
```

## ✨ 最新改進

### 🛠️ v2.0 更新（已修復）
- ✅ **Flask 重載修復**：禁用自動重載避免雙重啟動
- ✅ **重試機制**：增加3次重試邏輯
- ✅ **等待時間優化**：延長進程終止等待時間
- ✅ **多重驗證**：5次檢查端口釋放狀態
- ✅ **錯誤處理改進**：更詳細的故障排除建議

### 🎯 特色優勢
- 🎯 **零配置啟動**：無需任何設定，直接運行
- ⚡ **秒級啟動**：自動清理+啟動，總時間不超過15秒
- 🛡️ **安全可靠**：智能識別，只終止相關進程
- 🔄 **容錯機制**：多重檢查，確保啟動成功
- 🚀 **穩定運行**：解決 Flask debug 模式衝突問題 