# FireGuard AI æ¸¬è©¦æ¡†æ¶

## æ¦‚è¿°

æœ¬æ¸¬è©¦æ¡†æ¶ç‚º FireGuard AI å°ˆæ¡ˆæä¾›å®Œæ•´çš„æ¸¬è©¦è¦†è“‹ï¼ŒåŒ…æ‹¬å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦ã€‚

## ç›®éŒ„çµæ§‹

```
tests/
â”œâ”€â”€ conftest.py                    # pytesté…ç½®å’Œå…±äº«fixtures
â”œâ”€â”€ pytest.ini                    # pytestè¨­å®šæª”
â”œâ”€â”€ README.md                      # æœ¬æ–‡ä»¶
â”œâ”€â”€ unit/                          # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ test_simple.py        # åŸºç¤æ¸¬è©¦ï¼ˆç„¡å¤–éƒ¨ä¾è³´ï¼‰
â”‚   â”‚   â””â”€â”€ test_cnn_model.py     # CNNæ¨¡å‹æ¸¬è©¦ï¼ˆéœ€è¦torchï¼‰
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ test_ai_service.py    # AIæœå‹™æ¸¬è©¦ï¼ˆéœ€è¦openaiï¼‰
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ test_security_utils.py # å®‰å…¨å·¥å…·æ¸¬è©¦
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ test_detection.py     # APIæª¢æ¸¬ç«¯é»æ¸¬è©¦ï¼ˆéœ€è¦flaskï¼‰
â”œâ”€â”€ integration/                   # æ•´åˆæ¸¬è©¦
â”‚   â”œâ”€â”€ test_api_endpoints.py     # APIç«¯é»æ•´åˆæ¸¬è©¦
â”‚   â””â”€â”€ test_complete_workflow.py # å®Œæ•´å·¥ä½œæµç¨‹æ¸¬è©¦
â””â”€â”€ fixtures/                     # æ¸¬è©¦æ•¸æ“š
```

## åŸ·è¡Œæ¸¬è©¦

### 1. åŸºç¤æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰

é‹è¡Œä¸éœ€è¦å¤–éƒ¨ä¾è³´çš„æ¸¬è©¦ï¼š

```bash
# é‹è¡ŒåŸºç¤æ¸¬è©¦
python3 -m pytest tests/unit/models/test_simple.py tests/unit/utils/test_security_utils.py -v

# é‹è¡Œç‰¹å®šæ¸¬è©¦
python3 -m pytest tests/unit/utils/test_security_utils.py::TestStringInput -v
```

### 2. å®Œæ•´æ¸¬è©¦ï¼ˆéœ€è¦å®‰è£ä¾è³´ï¼‰

å¦‚æœå·²å®‰è£æ‰€æœ‰ä¾è³´ï¼ˆflask, torch, openaiç­‰ï¼‰ï¼š

```bash
# é‹è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦
python3 -m pytest tests/unit/ -v

# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
python3 -m pytest -v

# é‹è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
python3 -m pytest --cov=. --cov-report=html
```

### 3. å®‰è£æ¸¬è©¦ä¾è³´

```bash
# å®‰è£åŸºæœ¬ä¾è³´
pip install pytest pytest-cov pytest-mock

# å®‰è£å®Œæ•´ä¾è³´
pip install -r requirements.txt
```

## æ¸¬è©¦é¡åˆ¥

### å–®å…ƒæ¸¬è©¦

- **test_simple.py**: åŸºç¤æ¸¬è©¦ï¼Œé©—è­‰å°ˆæ¡ˆçµæ§‹ã€é…ç½®å’ŒåŸºæœ¬åŠŸèƒ½
- **test_security_utils.py**: å®‰å…¨å·¥å…·å‡½æ•¸æ¸¬è©¦ï¼ŒåŒ…æ‹¬è¼¸å…¥é©—è­‰å’Œæ¸…ç†
- **test_cnn_model.py**: CNNæ¨¡å‹æ¸¬è©¦ï¼ˆéœ€è¦torchï¼‰
- **test_ai_service.py**: AIæœå‹™æ¸¬è©¦ï¼ˆéœ€è¦openaiï¼‰
- **test_detection.py**: APIæª¢æ¸¬ç«¯é»æ¸¬è©¦ï¼ˆéœ€è¦flaskï¼‰

### æ•´åˆæ¸¬è©¦

- **test_api_endpoints.py**: å®Œæ•´APIç«¯é»æ¸¬è©¦
- **test_complete_workflow.py**: ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹æ¸¬è©¦

## æ¸¬è©¦è¦†è“‹ç¯„åœ

### âœ… å·²æ¸¬è©¦æ¨¡çµ„

- å°ˆæ¡ˆçµæ§‹é©—è­‰
- é…ç½®æ–‡ä»¶é©—è­‰
- å®‰å…¨å·¥å…·å‡½æ•¸
- å­—ä¸²è¼¸å…¥æ¸…ç†
- è§’è‰²å’Œæä¾›è€…é©—è­‰
- æ©Ÿç‡å’Œå¸ƒçˆ¾å€¼é©—è­‰
- æª”åå’ŒURLé©—è­‰
- API Keyé©—è­‰

### ğŸš§ éœ€è¦ä¾è³´çš„æ¸¬è©¦

- CNNæ¨¡å‹è¼‰å…¥å’Œé æ¸¬
- AIæœå‹™ï¼ˆOpenAI/Ollamaï¼‰
- Flask APIç«¯é»
- åœ–åƒè™•ç†å’Œä¸Šå‚³
- å®Œæ•´å·¥ä½œæµç¨‹

## æ¸¬è©¦é…ç½®

### pytest.ini é…ç½®

- æ¸¬è©¦è·¯å¾‘: `tests/`
- è¦†è“‹ç‡å ±å‘Š: HTML + çµ‚ç«¯
- è­¦å‘Šéæ¿¾: å¿½ç•¥ç¬¬ä¸‰æ–¹åº«è­¦å‘Š
- æ¨™è¨˜ç³»çµ±: unit, integration, slow, ai, model

### ç’°å¢ƒè®Šæ•¸

æ¸¬è©¦æ™‚è‡ªå‹•è¨­ç½®ï¼š
- `TESTING=True`
- `AI_PROVIDER=mock`

## æœ€ä½³å¯¦è¸

1. **å„ªå…ˆé‹è¡ŒåŸºç¤æ¸¬è©¦**: ç„¡éœ€å¤–éƒ¨ä¾è³´ï¼ŒåŸ·è¡Œé€Ÿåº¦å¿«
2. **ä½¿ç”¨æ¨™è¨˜**: å€åˆ†ä¸åŒé¡å‹çš„æ¸¬è©¦
3. **Mockå¤–éƒ¨æœå‹™**: é¿å…æ¸¬è©¦ä¾è³´å¤–éƒ¨API
4. **æ¸…ç†æ¸¬è©¦è³‡æº**: è‡ªå‹•æ¸…ç†è‡¨æ™‚æ–‡ä»¶
5. **è©³ç´°æ–·è¨€**: æä¾›æ¸…æ™°çš„æ¸¬è©¦å¤±æ•—ä¿¡æ¯

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **ModuleNotFoundError**: ç¼ºå°‘ä¾è³´æ¨¡çµ„
   ```bash
   pip install -r requirements.txt
   ```

2. **ImportéŒ¯èª¤**: Pythonè·¯å¾‘å•é¡Œ
   ```bash
   export PYTHONPATH=/home/lean/fire_report_project:$PYTHONPATH
   ```

3. **æ¬Šé™éŒ¯èª¤**: æª”æ¡ˆå­˜å–æ¬Šé™
   ```bash
   chmod +x run_tests.sh
   ```

### è·³éç‰¹å®šæ¸¬è©¦

```bash
# è·³ééœ€è¦ç¶²è·¯çš„æ¸¬è©¦
python3 -m pytest -m "not network"

# è·³ééœ€è¦GPUçš„æ¸¬è©¦
python3 -m pytest -m "not gpu"
```

## æŒçºŒæ”¹é€²

- [ ] æ·»åŠ æ›´å¤šé‚Šç•Œæ¡ˆä¾‹æ¸¬è©¦
- [ ] æé«˜æ¸¬è©¦è¦†è“‹ç‡åˆ°90%+
- [ ] æ·»åŠ æ€§èƒ½åŸºæº–æ¸¬è©¦
- [ ] æ•´åˆCI/CDè‡ªå‹•åŒ–æ¸¬è©¦
- [ ] æ·»åŠ å›æ­¸æ¸¬è©¦å¥—ä»¶